{# src/ClientBundle/Resources/views/Cliente/direccion.html.twig #}
{% extends 'ClientBundle:Page:base.html.twig' %}

{% block body %}
    <div class="container">
        <br />
        {% if direccion is defined %}
            <h2>Modificar direcci贸n</h2>
        {% else %}
            <h2>Insertar direcci贸n</h2>
        {% endif %}
        {% if info is defined and info != null %}
        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-danger">{{ info }}</div>
            </div>
        </div>
        {% endif %}
        {% if direccion is defined %}
            <form method="post" id="form-account" action="{{ path('cuenta_direcciones_guardar', {'id_direccion': direccion.id}) }}">
        {% else %}
            <form method="post" id="form-account" action="{{ path('cuenta_direcciones_add') }}">
        {% endif %}
            <div class="row">
                <div class="col-md-12">
                    <label for="direccion">Direcci贸n</label>
                    <input type="text" class="form-control" name="direccion" id="direccion" {% if direccion is defined %} value="{{ direccion.domicilio }}" {% endif %} placeholder="Direccion">
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <label for="direccion">Direcci贸n extra</label>
                    <input type="text" class="form-control" name="direccion-extra" id="direccion-extra" {% if direccion is defined %} value="{{ direccion.direccionExtra }}" {% endif %} placeholder="Direccion extra">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="provincias">Provincia</label>
                    {% if provincias is defined %}
                        <select class="form-control" name="provincia" id="provincias">
                        {% for provincia in provincias %}
                            {% if direccion is defined and provincia.id == direccion.localidad.provincia.id %}
                                <option value="{{ provincia.id }}" selected>{{ provincia.nombre }}</option>
                            {% else %}
                                <option value="{{ provincia.id }}">{{ provincia.nombre }}</option>
                            {% endif %}
                        {% endfor %}
                        </select>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <div class="form-group" id="select-localidades">
                        <label for="localidades">Localidad</label>
                        <select class="form-control" name="localidad" id="direccion_localidad" required>
                        {% if direccion is defined %}
                            <option value="{{ direccion.localidad.id }}" selected>{{ direccion.localidad.nombre }}</option>
                        {% endif %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" class="btn btn-primary" name="save-account" value="Aceptar">
                <a href="{{ path('cuenta_direcciones') }}" class="btn btn-danger">Cancelar</a>
            </div>
        </form>
    </div>
{% endblock %}
{% block javascripts %}
    <script>
        (function(){

            function checkProvinciaSelected(){
                changeLocalidades($('#provincias').val());
            }

            function changeLocalidades(b){
                $("#select-localidades select").empty();
                $.getJSON('localidades?provincia='+b,function(data){
                    $.each(data, function(id,value){
                        $("#select-localidades select").append('<option value="'+value[2]+'">'+value[0]+' ('+value[1]+') </option>');
                    });
                });
            }

            {% if direccion is defined %}

            $('#direccion_localidad').bind('click', function(){
                if($('#direccion_localidad').val() == {{ direccion.localidad.id }}) {
                    checkProvinciaSelected();
                }
            });

            {% endif %}
            
        })();
    </script>
{% endblock %}